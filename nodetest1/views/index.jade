extends layout

block content
  h1 VideoGami Lite


  a(href="/setup_accounts")
    button(type="button") Go to account setup
  br

  a(href="/logo_setup")
    button(type="button") Go to logo setup
  br

  h2 Input source 
  form(action='/input', method='post', id='input')
    label(for='input ') Enter your HLS input 
    input(type='text', value='', name='input', id='input')
    button(type="submit") submit

  h2 Step 2: Stream settings
  form(action='/streamsettings', method='post', id='streamSettings')
    label(for='input ') Enter your Stream Name
    br
    input(type='text', value='', onchange="checkNameChange()", name='name', id='streamName')
    br
    h3 choose your streaming destinations
    label(for='youtube') Youtube 
    input(type='checkbox', onchange="enableBtnYT()", value='true', name='youtube', id='youtube') 
    br
    label(for='Facebook') Facebook  
    input(type='hidden', value='', name='rtmplink', id='FBNowInputBox')
    input(type='checkbox', onchange="streamFB()", onclick="enableBtnFB()", value='true', name='facebook', id='facebook') 
    br
    label(for='joicaster') Joicaster 
    input(type='checkbox', value='true', onchange="enableBtnJC()", name='joicaster', id='joicaster') 
    br
    br
    button(type="submit", disabled="disabled", id="streamNowBtn") Stream now
    br
    h3 OR Schedule a stream
    br 
    label(for='Month ') Month (1-12)
    input(type='text', value='', name='month', id='Month', placeholder="1")
    br
    label(for='Day ') Day (1-31)
    input(type='text', value='', name='day', id='Day', placeholder="7")
    br
    label(for='Hour ') Hour (1-23)
    input(type='text', value='', name='hour', id='Hour', placeholder="15")
    br
    label(for='Month ') minute (1-59)
    input(type='text', value='', name='minute', id='minute', placeholder="3")
    br
    button(type="submit", disabled="disabled", id="scheduleStreamBtn") schedule stream 
    br

  form(action='/cancelstream', method='post', id='CancelStream')
    button(type="submit") Cancel scheduled stream 
  br

  a(href="/stop")
    button(type="button") Stop Streaming
  br
  br
  
  
  script.
    let accr = 0
    let checkerYT = false
    let checkerJC = false
    let checkerFB = false
    function checkNameChange(){
      let streamName = document.getElementById("streamName").value
      if(streamName){
        if (accr > 0){
            document.getElementById("streamNowBtn").disabled = false;
            document.getElementById("scheduleStreamBtn").disabled = false;
          } 
      }
    }
    function enableBtnYT(){
      let streamName = document.getElementById("streamName").value
      if (checkerYT === false){
        checkerYT = true
        accr ++ 
        console.log(streamName)
          if (accr > 0 && streamName){
            document.getElementById("streamNowBtn").disabled = false;
            document.getElementById("scheduleStreamBtn").disabled = false;
          } 
        } else {
          accr --
          console.log(streamName)
          checkerYT = false
          if (accr === 0){
            document.getElementById("streamNowBtn").disabled = true
            document.getElementById("scheduleStreamBtn").disabled = true
          }
        }
      }
    function enableBtnFB(){
      let streamName = document.getElementById("streamName").value
      if (checkerFB === false){
        checkerFB = true
        accr ++ 
        console.log(accr)
          if (accr > 0 && streamName){
            document.getElementById("streamNowBtn").value = "processing..."
            setTimeout(function(){ 
              let FBrtmp = document.getElementById("FBNowInputBox").value
              if(FBrtmp){
              document.getElementById("streamNowBtn").disabled = false;
              document.getElementById("scheduleStreamBtn").disabled = false;
              }
             }, 3000);
             document.getElementById("streamNowBtn").value = "Stream Now"
          } 
        } else {
          accr --
          console.log(accr)
          checkerFB = false
          if (accr === 0){
            document.getElementById("streamNowBtn").disabled = true
            document.getElementById("scheduleStreamBtn").disabled = true;
          }
        }
      }
    function enableBtnJC(){
      let streamName = document.getElementById("streamName").value
      if (checkerJC === false){
        checkerJC = true
        accr ++ 
        console.log(accr)
          if (accr > 0 && streamName){
            document.getElementById("streamNowBtn").disabled = false;
            document.getElementById("scheduleStreamBtn").disabled = false;
          } 
        } else {
          accr --
          console.log(accr)
          checkerJC = false
          if (accr === 0){
            document.getElementById("streamNowBtn").disabled = true
            document.getElementById("scheduleStreamBtn").disabled = true;
          }
        }
      }

  script.
    window.fbAsyncInit  = function()  {
    FB.init({
      appId             : '202133753681543',
      autoLogAppEvents  : true,
      xfbml             : true,
      version           : 'v2.11'
      });
      };

    function streamFB(){
      FB.api(
        '/913878858767085/live_videos',
        'POST',
        {access_token: "EAAC31u6V1ocBANKZAMreCkjL3UjJoNpRI5HoKfvsXQ95QZBCJfyjKcjzPrYvcK0ZBNsDQH039C471FcoUhpT0SgxKkOP5UKZAquPtlDZB8I7ZCFas0syDtHhxpHywpSx5eU2ZAaZBFvqq9vLxRE5jjmEE2zsWqy929QpRjFqe25IDQZDZD"},
        function(response) {
            let rtmp = response.stream_url
            console.log(rtmp)
            console.log(response)
            document.getElementById("FBNowInputBox").value = rtmp;
        }
      );
    }
 
  script.
    (function(d, s, id){
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

